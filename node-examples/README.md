# Node Examples using JSON web tokens with Qlik Sense Enterprise

* [General](#general)
* [Simple](#simple)
* [Express Server redirect to Hub](#express)
* [Express Server mashup](#mashup)

<a name="general"></a>
## general information

* Please make sure to import the Consumer Sales app (if you have not already) before running the mashup example.

* Please follow the **[instructions}(../README.MD#vproxy)** on setting up a json web token virtual proxy in Qlik Sense before continuing with the node examples.

* Each example requires some configuration in the corresponding js file and support files.  Please follow the configuration instructions below.

### general configuration

> _jwtEncryptionKey_: Enter the path to the private key used to encrypt the json web token.


> _hostname_: Hostname of Qlik Sense server where jwt token will be sent.

> _prefix_: The virtual proxy prefix for the json web token integration in Qlik.

> _token_: The token is the json object that will be encrypted and sent to the Qlik Sense Proxy for authentication.  It is possible to add as many attributes desired.  In the provided example, observe how strings are used to provide userid and userdirectory information, and an array of strings is used to send group attributes.

### sample token
```
var token = jwt.sign({
    "userId": "boz",
    "userDirectory": "example",
    "email": "boz@example.com",
    "Group": ["sales", "finance", "marketing"]
}, jwtEncryptionKey, {
    "algorithm": "RS256"
})
```

<a name="simple"></a>
## simple example (jwtSimple.js)

The simple jwt example creates a token and makes a connection to the Qlik Repository Service API (QRS).

### additional configuration

> _jwtDecryptionKey_: Enter the path to the public key that will be used to decrypt the jwt token.

<a name="express"></a>
## express example (jwtExpress.js)

The express example creates the token, gets the session cookie from the response, and sets the cookie in the browser.  From there, it redirects to the hub.

### additional configuration

> _serverKey_: Enter the path to the private key used to secure this website.  This private key is for running express, not for encrypting the token.

> _serverCert_: Enter the path to the server certificate used for this website.  This private key is for running express, not for encrypting the token.

### Usage

1. From a command prompt, run node jwtExpress.js.
2. Launch a browser and navigate to the friendly name of the express server.  e.g. https://test.example.com:8185/login.

<a name="mashup"></a>
## mashup example (jwtMashup.js)

The mashup example demonstrates loading Qlik resources from a web page hosted on a remote web server from the Qlik Sense environment.

### additional configuration

> _serverKey_: Enter the path to the private key used to secure this website.  This private key is for running express, not for encrypting the token.

> _serverCert_: Enter the path to the server certificate used for this website.  This private key is for running express, not for encrypting the token.

### index.html configuration

Replace the hostname and prefix in the url for the following lines in the index.html file:

```
if hostname = test.example.com and prefix = jwt then

<link rel="stylesheet" href="https://hostname/prefix/resources/autogenerated/qlik-styles.css">

becomes

<link rel="stylesheet" href="https://test.example.com/jwt/resources/autogenerated/qlik-styles.css">

and 

<script src="https://hostname/prefix/resources/assets/external/requirejs/require.js"></script>

becomes

<script src="https://test.example.com/jwt/resources/assets/external/requirejs/require.js"></script>
```

### index.js configuration

Replace the prefix value with the value of the prefix for the virtual proxy set up for the example.  Replace the host value with the hostname of the Qlik Sense server.

```
var prefix = "/prefix/"; //change virtual proxy prefix to the prefix defined in the virtual proxy configuration.
var config = {
    host: "Enter Qlik Sense host name here", //e.g. test.example.com
    prefix: prefix,
    port: 443,
    isSecure: true
};
```

### Usage

1. From command prompt enter Node jwtMashup.js.
2. Launch a browser and navigate to the friendly name of the express server.  e.g. https://test.example.com:8185/mashup.